

<!DOCTYPE html>
<html lang="en">
<head>
  


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>字符串哈希匹配 [ ooxoio blog ]</title>

  <link rel="icon" href="/img/icon.png">


    <meta name="author" content="ooxoio">





  <link rel="alternate" href="/atom.xml " title="ooxoio blog" type="application/atom+xml">


  
    <link rel="stylesheet" href="/css/main.css">
  

<meta name="generator" content="Hexo 5.4.0"></head>
  <body data-theme="light" class="notransition">
    <script>
      const body = document.body;
      const data = body.getAttribute("data-theme");
      const initTheme = (state) => {
        if (state === "dark") {
          body.setAttribute("data-theme", "dark");
        } else if (state === "light") {
          body.removeAttribute("data-theme");
        } else {
          localStorage.setItem("theme", data);
        }
      };
   
      initTheme(localStorage.getItem("theme"));
      
      setTimeout(() => body.classList.remove("notransition"), 75);
    </script>
  <div class="navbar" role="navigation">
    <nav class="menu">
      <input type="checkbox" id="menu-trigger" class="menu-trigger" />
      <label for="menu-trigger">
        <span class="menu-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 512 512"
          >
            <path
              d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z"
            />
          </svg>
        </span>
      </label>
      <a id="mode">
        <svg
          class="mode-sunny"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 512 512"
        >
          <title>LIGHT</title>
          <line
            x1="256"
            y1="48"
            x2="256"
            y2="96"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="256"
            y1="416"
            x2="256"
            y2="464"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="108.92"
            x2="369.14"
            y2="142.86"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="369.14"
            x2="108.92"
            y2="403.08"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="464"
            y1="256"
            x2="416"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="96"
            y1="256"
            x2="48"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="403.08"
            x2="369.14"
            y2="369.14"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="142.86"
            x2="108.92"
            y2="108.92"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <circle
            cx="256"
            cy="256"
            r="80"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
        </svg>
        <svg
          class="mode-moon"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 512 512"
        >
          <title>DARK</title>
          <line
            x1="256"
            y1="48"
            x2="256"
            y2="96"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="256"
            y1="416"
            x2="256"
            y2="464"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="108.92"
            x2="369.14"
            y2="142.86"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="369.14"
            x2="108.92"
            y2="403.08"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="464"
            y1="256"
            x2="416"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="96"
            y1="256"
            x2="48"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="403.08"
            x2="369.14"
            y2="369.14"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="142.86"
            x2="108.92"
            y2="108.92"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <circle
            cx="256"
            cy="256"
            r="80"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
        </svg>
      </a>
      <div class="trigger">
        <div class="trigger-container">
          
            
            
            
            
            
            
            <a class="menu-link " href="/"> Home</a>
          
            
            
            
            
            
            
            <a class="menu-link " href="/archives/"> Archives</a>
          
            
            
            
            
            
            
            <a class="menu-link " href="/about/"> About</a>
          
            
            
            
            
            
            
            <a class="menu-link " href="/tags/"> Tags</a>
          
        </div>
      </div>
    </nav>
  </div>
  
<div class="wrapper post">
  <main class="page-content" aria-label="Content">
      <header class="header">
        
          <div class="tags">
            <a href="/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" class="tag"># 每日一题</a><a href="/tags/%E7%AE%97%E6%B3%95/" class="tag"># 算法</a>
          </div>
        
        <h1 class="header-title" itemprop="headline">字符串哈希匹配</h1>
          <div class="post-meta">
            <time>Dec 23, 2021</time>
            <span itemprop="author">
              <span itemprop="name">ooxoio</span>
            </span>
          </div>
        </header>

          <div class="page-content"><h3 id="字符串：哈希匹配"><a href="#字符串：哈希匹配" class="headerlink" title="字符串：哈希匹配"></a>字符串：哈希匹配</h3><h4 id="题目场景："><a href="#题目场景：" class="headerlink" title="题目场景："></a>题目场景：</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在S串中任意取两个子串，判断它们是否相等。</span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>T串长度为m，在S串中取长度为m的子串判断是否和T相等。</span><br><span class="line"> </span><br><span class="line">两者的区别是： </span><br><span class="line">    		第一个场景是任取的，比较复杂。</span><br><span class="line">    		第二个场景类似滑动窗口，我们可以在S串中模拟长度为m的窗口。</span><br><span class="line">    </span><br><span class="line">下面先主要讨论场景一，场景二比较简单最后简洁概括。</span><br></pre></td></tr></table></figure>

<h4 id="1-引入"><a href="#1-引入" class="headerlink" title="1.引入"></a>1.引入</h4><p>我们知道判断两个字符串是否相等与判断两个数字是否相等，前者时间复杂度为O(N),后者为O(1)。因此，如果能将字符串通过哈希转为一个数字，再进行比较，效率方面会提高很多。这就是哈希匹配的主要思想。</p>
<p>哈希匹配的关键：</p>
<p>1.哈希函数</p>
<p>2.哈希碰撞/冲突</p>
<p>哈希函数可以有很多种，通常字符串哈希会采用位权累加，类似于二进制转十进制的方式一样，此时位权就是2。</p>
<p>如果直接采取上述方式，那么就不会有哈希冲突的问题，不同的字符串哈希出来的数一定不同。</p>
<ul>
<li><p>问题就在于：位权如果过大，字符串如果太长，那么这个哈希值通常是会溢出的，即使long long也不够用。</p>
<p>解决方法：模运算，在哈希的过程中不断取余，把哈希值控制在安全范围。</p>
</li>
<li><p>而取余的话，就有几率发生哈希冲突，两个不同的字符串哈希值取余后可能会相同。</p>
<p>解决方法：当哈希值相同的时候，采用暴力匹配去判断两个字符串是否相同。如果哈希值都不相同，那么两个字符串一定不同。</p>
<p>因为哈希碰撞的情况还是非常低概率的，所以这个过程可以大大减少暴力匹配的次数。</p>
<p>并且有很多方法来减少冲突的可能：1.模数取质数。2.使用不同的位权和模数多次哈希，如果两次哈希都相同，我们有极高的概率可以认为它们是同一个字符串。</p>
</li>
</ul>
<hr>
<h4 id="2-推导过程："><a href="#2-推导过程：" class="headerlink" title="2.推导过程："></a>2.推导过程：</h4><p>假设我们对场景1的S串任取当中两个子串T = S[L,R] U = S[A,B]，我们要求这个子串t的哈希值。</p>
<p>位权base，模数。这里就直接以s[i]的ascii码直接作为当前位的值，当然一般情况如果都是小写字母，我们会 - ‘a’，使其范围落在[0,26]。</p>
<p>则：</p>
<p>hash(T) = ((s[L] * base^(L - 1) + S[L + 1] * base ^(L) +….. S[R] * base^(R - 1)) mod P.</p>
<p>同理可求hash(U)，但是这杨我们是无法比较的，T串最低权重是base^(L - 1)，U串则是 base^(A - 1)。</p>
<p>我们应该对上述哈希和除以最低位权，使其权重是从[0,base ^ 1,….,base ^ R - 1]，这也才能比较。其实很好理解，我这里有点过于赘述了。</p>
<p>因此：</p>
<p>Hash(T) = ( (hash(T) / (base ^ (L - 1)) ) ) mod P.</p>
<p>冷知识：</p>
<p>1.百度百科中取模等式等价变形中，是没有除法的。对于上述Hash(T)中的 / ,我们必须转化为 *。</p>
<p>2.逆元：</p>
<p>如果（X * Y） % P = 1，则称X 和 Y互为逆元。</p>
<p>并且有如下公式：</p>
<p>（A / X) % P = (A * Y) % P</p>
<p>因此，上述Hash可以根据逆元进行修改，将除法变长。</p>
<p>上述Hash有两部分，前者hash(T)可以使用前缀和快速求得。那么现在的问题就是一个数的逆元怎么求。</p>
<h4 id="3-逆元推导"><a href="#3-逆元推导" class="headerlink" title="3.逆元推导"></a>3.逆元推导</h4><p>上面什么base ^ (L - 1)看的烦死了，反正就是求一个数的逆元。</p>
<p>我们现在场景就是 ：求X在模P运算下的的逆元。</p>
<p><img src="/2021/12/23/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%93%88%E5%B8%8C%E5%8C%B9%E9%85%8D/image-20211223221634665.png" alt="image-20211223221634665"></p>
<p>于是我们就将问题转化为了求r在模P运算下的逆元。因此可从小大大递推[1,P -  1]每个数的逆元。</p>
<h4 id="4-代码编写方面："><a href="#4-代码编写方面：" class="headerlink" title="4.代码编写方面："></a>4.代码编写方面：</h4><p>1.前缀和数组pre</p>
<p>2.权重数组K</p>
<p>3.逆元数组inverse，只需要对[1, P - 1]的每个数求其逆元，因为权重base ^ (L - 1)我们也是对P取模的，所以不会大于P。</p>
<p>4.先预处理求出这三个数组后，根据范围S[L,R]，用前缀和求出(pre[L,R] * inverse[K[L - 1]]) % P，该值即为最终的哈希值。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000000	<span class="comment">// 字符串长度</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> P 10007		</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> base 13</span></span><br><span class="line"><span class="keyword">char</span> s[MAX_N + <span class="number">5</span>];	<span class="comment">// 字符串S</span></span><br><span class="line"><span class="keyword">int</span> val[P + <span class="number">5</span>];		<span class="comment">// 逆元数组</span></span><br><span class="line"><span class="keyword">int</span> K[MAX_N + <span class="number">5</span>];	<span class="comment">// 权重数组</span></span><br><span class="line"><span class="keyword">int</span> pre[MAX_N + <span class="number">5</span>];	<span class="comment">// 前缀和数组</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val[<span class="number">1</span>] = <span class="number">1</span>;	 	<span class="comment">// 1的逆元肯定是1</span></span><br><span class="line">    <span class="comment">// 从小到大递推的求每个数的逆元</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; P; i++) &#123;</span><br><span class="line">        <span class="comment">// x^-1 = -k * r^-1  k = P / i, r^-1 = val[P % x]  </span></span><br><span class="line">        val[i] = ((-(P / i) * (val[P % i])) % P + P) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// base^0 = 1,求一下权重数组方便后面使用</span></span><br><span class="line">    K[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= MAX_N; i++) &#123;</span><br><span class="line">        K[i] = (K[i - <span class="number">1</span>] * base) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 前缀和数组</span></span><br><span class="line">    pre[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= MAX_N; i++) &#123;</span><br><span class="line">        pre[i] = (pre[i - <span class="number">1</span>] + K[i] * s[i]) % P;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_hash</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// hash(l,r) * val[K[l]]</span></span><br><span class="line">    <span class="keyword">return</span> (((pre[r] - pre[l - <span class="number">1</span>]) * val[K[l]]) % P + P) % P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;m);</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> ll,lr,rl,rr;</span><br><span class="line">        cin &gt;&gt; ll &gt;&gt; lr &gt;&gt; rl &gt;&gt; rr;</span><br><span class="line">        <span class="keyword">int</span> size1 = lr - ll;</span><br><span class="line">        <span class="keyword">int</span> size2 = rr - rl;</span><br><span class="line">        <span class="keyword">int</span> num1 = <span class="built_in">get_hash</span>(ll,lr);</span><br><span class="line">        <span class="keyword">int</span> num2 = <span class="built_in">get_hash</span>(rl,rr);</span><br><span class="line">        <span class="keyword">if</span> (size1 != size2 || num1 != num2) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;No\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> flag = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size1; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s[ll + i] != s[rl + i]) &#123;</span><br><span class="line">                    flag = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Yes\n&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;No\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h4><p>其实思路方面还是比较清晰的，就是一个除法在取模中需要转化为逆元，引入逆元的概念和逆元的推导过程。</p>
<p>但是这个方法感觉还是挺实用的，毕竟一次哈希可能走大运冲突了，我两次哈希还冲突那真是倒霉他妈给倒霉开门，倒霉到家了。。</p>
<h4 id="6-Rabin-Karp"><a href="#6-Rabin-Karp" class="headerlink" title="6.Rabin-Karp"></a>6.Rabin-Karp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">回顾上述的场景<span class="number">2</span>：</span><br><span class="line">    T串长度为m，在S串中取长度为m的子串判断是否和T相等。</span><br></pre></td></tr></table></figure>

<p>对于场景2，我们通常使用rabin-Karp算法来处理，但主要思路还是一样，都是通过将字符串进行哈希，再直接判断。只不过此时是像滑动窗口一样的，我们可以快速求出滑动过程中每个窗口字符串的哈希值。</p>
<p>1.先像上面一样先求字符串T的哈希值，但是不用 除 最低权重，所以直接累加取模即可。</p>
<p>需要注意的是，此时s[0]的权重我们取base ^ (m - 1)，依次递减，即和场景一的反过来。</p>
<p>2.在S串上滑动的过程，其实就是每轮舍弃掉窗口最左边的字符，新增窗口右边新进入的字符。</p>
<p>S串也一样像步骤一一样求第一个窗口里的字符串的哈希值，假设 = hash。</p>
<p>那么下一次滑动后的哈希值为： hash * base - ( (s[l] - ‘a’) * base ^ m  ) + (s[r] - ‘a’)。</p>
<p>即，整体先乘base代表右移，但是窗口最左边的要舍弃，所以减去它贡献的哈希值，注意因为我们先承了base，所以它的权重原先是m - 1变成 m 。然后加上最右边刚进来的字符贡献的哈希值即可。</p>
<p>这样我们就实现了在O(1)下完成哈希。</p>
<p>该算法的时间复杂度为：O(n + m)。O(m)为先求T串的哈希值时间复杂度。O(n)为滑动过程。</p>
<p>练习题目：</p>
<p>LC.1044 最长重复子串</p>
<p>这题没有那么直观的使用该算法，但是但凡涉及找子串是否等于某个字符串的，都可以采用哈希匹配来解决，并且效率其实挺高的。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1044.</span> 最长重复子串</span><br><span class="line">给你一个字符串 s ，考虑其所有 重复子串 ：即，s 的连续子串，在 s 中出现 <span class="number">2</span> 次或更多次。这些出现之间可能存在重叠。</span><br><span class="line"></span><br><span class="line">返回 任意一个 可能具有最长长度的重复子串。如果 s 不含重复子串，那么答案为 <span class="string">&quot;&quot;</span> 。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 <span class="number">1</span>：</span><br><span class="line"></span><br><span class="line">输入：s = <span class="string">&quot;banana&quot;</span></span><br><span class="line">输出：<span class="string">&quot;ana&quot;</span></span><br><span class="line">示例 <span class="number">2</span>：</span><br><span class="line"></span><br><span class="line">输入：s = <span class="string">&quot;abcd&quot;</span></span><br><span class="line">输出：<span class="string">&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">提示：</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> &lt;= s.length &lt;= <span class="number">3</span> * <span class="number">104</span></span><br><span class="line">s 由小写英文字母组成</span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">31</span>;</span><br><span class="line">    <span class="function">string <span class="title">longestDupSubstring</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = s.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">auto</span> check = [&amp;](<span class="keyword">int</span> len) &#123;</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>  hash = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> base = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                hash = hash * p + (s[i] - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">                base *= p;</span><br><span class="line">            &#125;</span><br><span class="line">            unordered_set&lt;<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>&gt; sset;</span><br><span class="line">            sset.<span class="built_in">insert</span>(hash);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = len; i &lt; s.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">                hash = hash * p - base * (s[i - len] - <span class="string">&#x27;a&#x27;</span>) + (s[i] - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span> (sset.<span class="built_in">count</span>(hash)) &#123;</span><br><span class="line">                    start = i - len + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                sset.<span class="built_in">insert</span>(hash);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = l + (r - l + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) &#123;</span><br><span class="line">                l = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> start == <span class="number">-1</span>?<span class="string">&quot;&quot;</span> : s.<span class="built_in">substr</span>(start, l);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-参考资料"><a href="#7-参考资料" class="headerlink" title="7.参考资料"></a>7.参考资料</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">https:<span class="comment">//blog.csdn.net/zhoujl25/article/details/62419372</span></span><br><span class="line">https:<span class="comment">//blog.csdn.net/lucylove3943/article/details/83491416</span></span><br></pre></td></tr></table></figure>

</div>
          <nav class="post-nav">
    
    
    <a class="post-nav-item post-nav-next" href="/2021/12/14/%E8%B4%AA%E5%BF%83%EF%BC%9A%E9%80%89%E8%AF%BE/">
      <div class="nav-arrow">OLDER&nbsp;&gt;</div>
      <span class="post-title">贪心：选课</span>
    </a>
    
  </nav>

   </main>
</div>

  <footer class="footer">
    <small class="footer_copyright">
      <div id="bottom-inner">
        © 2021 Site by ooxoio using
        <a target="_blank" rel="noopener" href="http://hexo.io">hexo blog framework</a>.
        <br>
        <p> Theme is <a target="_blank" rel="noopener" href="https://github.com/dewjohn/hexo-theme-klise">Klise</a></p>
      </div>
    </small>
  </footer>
  
  

    
      <script src="/js/main.js"></script>
    
  
  <script>
    window.FPConfig = {
      delay: 0,
      ignoreKeywords: [],
      maxRPS: 3,
      hoverDelay: 50,
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>
</body>
</html>
